<div class="<%= browser.mobile? ? 'popover-inner-mobile' : 'popover-inner' %>" id="species-popover-initial">
  <% unless (browser.mobile? || browser.tablet?) %><i id="overlay-close" class="icon-cancel"></i><% end %>
  <div class="images">
    <% if @species_selected.images.length == 0 %>
      <img src="<%= image_path 'not_found_original.png' %>" width=250px height=400px>
    <% else %>
      <% @species_selected.images.each do |image| %>
        <figure itemprop="associatedMedia" itemscope="" itemtype="http://schema.org/ImageObject">
          <a href="<%= image.image.url(:original) %>" itemprop="contentUrl" data-size="<%= image.image.image_size(:original) %>">
            <img src="<%= browser.mobile? ? image.image.url(:medium_mobile) : image.image.url(:medium_desktop) %>">
          </a>
        </figure>
      <% end %>
    <% end %>
  </div>
  <div class="content">
    <% if (browser.mobile? || browser.tablet?) %><i id="overlay-close" class="icon-cancel mobile"></i><% end %>
    <div class="title"><em><%= @species_selected.genusSpecies %></em></div>
    <div class="authority"><%= @species_selected.authority %></div>
    <div class="subtitle"><%= @species_selected.commonName %></div>
    <% unless (browser.mobile? || browser.tablet?) %><div class="share-button"></div><% end %>
    <div class="family"><abbr class="heading">Family name</abbr><br /><%= @species_selected.family.name %></div>
    <div class="description"><abbr class="heading">Description</abbr><br /><%= @markdown.render(@species_selected.description).html_safe %></div>
    <div class="distribution"><abbr class="heading">Distribution</abbr><br /><%= @species_selected.distribution %></div>
    <div class="information">
      <abbr class="heading">Information</abbr><br />
      <% if @species_selected.family.phylogeny %><%= @species_selected.family.phylogeny %><br /><% end %>
      <%= @markdown.render(@species_selected.information).html_safe %>
    </div>
  </div>
</div>


<script>
  $("#overlay-close").on('click', function() {
    $('#overlay-dark, #popover-outer').removeClass('selected')
    setTimeout(function() {
      $('#overlay-dark,#popover-outer').css('display', 'none')
      $("#species-popover-initial").remove()
      window.history.pushState('CampusFlora', 'Flora locations and information at Sydney Uni Campus - CampusFlora', window.location.protocol + "//" + window.location.host);
    }, 200);
  });

  new Share(".share-button", {
    url: "campusflora.sydneybiology.org/species/<%= @species_selected.slug %>",
    title: "<%= @species_selected.genusSpecies %>",
    description: "<%= @species_selected.genusSpecies %> @campusflora - campusflora.sydneybiology.org/species/<%= @species_selected.slug %>",
    ui: {
      button_text: 'Share'
    },
    networks: {
      facebook: {
        image: "http://campusflora.sydneybiology.org/<%= @species_selected.images.first.image.url(:original) %>"
      },
      pinterest: {
        enabled: false
      },
      twitter: {
        description: "I found <%= @species_selected.genusSpecies %> on campus! via @CampusFloraOz campusflora.sydneybiology.org/species/<%= @species_selected.slug %>"
      }
    }
  });

  // Bind the photoswipe gallery
  <% if @species_selected.images.length > 0 %>
    bindPhotoSwipe('.images');
  <% end %>
</script>